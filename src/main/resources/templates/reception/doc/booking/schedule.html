<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>杏林堂中医馆</title>
        <link rel="shortcut icon" href="/docByq/img/logo/favicon.png">
        <script src="/docByq/js/jquery-3.3.1.min.js"></script>
        <!-- FONT_AWESOME -->
        <link rel="stylesheet" href="/docByq/css/all.min.css">
        <link rel="stylesheet" href="/docByq/css/fontawesome.min.css">

        <!-- THEMIFY ICON -->
        <link rel="stylesheet" href="/docByq/css/themify-icons.css">

        <!-- X-ICON -->
        <link rel="stylesheet" href="/docByq/css/xicon.css">


        <!-- OWL CAROUSEL -->
        <link rel="stylesheet" href="/docByq/css/owl.carousel.min.css">

        <!-- CORE NAVIGATION -->
        <link rel="stylesheet" href="/docByq/css/coreNavigation-1.1.3.min.css">

        <!-- FANCY-BOX -->
        <link rel="stylesheet" href="/docByq/css/jquery.fancybox.min.css">

        <!-- BOOTSTRAP -->
        <link rel="stylesheet" href="/docByq/css/bootstrap.min.css">

        <!-- PERSONAL STYLE -->
        <link rel="stylesheet" href="/docByq/scss/style.css">
        <link rel="stylesheet" href="/docByq/css/responsive.css">

        <link rel="stylesheet" href="/docByq/css/style.css">
        <link rel="stylesheet" href="/docByq/css/iconfont.css"/>
        <script src="/js/HttpUtil.js"></script>

        <link rel="stylesheet" href="/doc/lib/layui-v2.6.3/css/layui.css">
        <script type="text/javascript" src="/js/xadmin.js"></script>
        <script src="/doc/lib/layui-v2.6.3/layui.js"></script>
        <script src="/schedule/lib/main.js"></script>
        <link rel="stylesheet" href="/schedule/lib/main.css">

    </head>
    <style>
        .done {
            text-align:center;
            font-weight:bold;
            line-height: 30px;
            width:100%;
        }
        input[name=timePeriod]{
            width:10%;
            height:30px;
            margin-bottom: 30px;
        }
        #doctorList span{
            line-height: 20px;
        }
    </style>
    <body>

        <!-- Preloader -->

        <div id="preloader">
            <div id="status">
                <img src="/docByq/img/logo/logo.png" alt="perloader">
            </div>
        </div>

        <!-- Header Top Bar Start -->

        <div class="header-top-bar d-md-block d-none">
            <div class="container">
                <div class="head-content d-md-flex d-block align-items-center">
                    <div class="logo d-none d-lg-block">
                        <a href="./home.html"><img src="/docByq/img/logo/logo.png" alt=""></a>
                    </div>
                    <div class="ml-auto content" style="color: aliceblue;">
                        <i class="ti-time"></i>
                        工作日： 08:00-19:00 <br>
                        星期六 和 星期天 - 休息
                    </div>
                    <div class=" content" >
                        <i class="ti-mobile"></i>
                        <div class="" >
                            <a style="color: aliceblue;" href="">(+86) 0777-8569442</a>
                            <br>
                            <a style="color: aliceblue;" href=""></a>
                        </div>
                    </div>
                    <div class="content" style="color: aliceblue;">
                        <i class="ti-location-pin"></i>

                    </div>
                </div>
            </div>
        </div>

        <!-- Header Start -->
        <header class="header">
            <nav class="">
                <!-- Mobile -->
                <div class="nav-header right">
                    <a href="/" class="brand d-lg-none d-block">
                        <img src="/docByq/img/logo/logo.png" alt="">
                    </a>
                    <button class="toggle-bar"><span class="fa fa-bars"></span></button>
                </div>
                <div class="header-btn">
                    <a href="/login/user" class="btn btn-secondary" id="demo1">
                        <i class="fas fa-lock"></i><span id="username">登录</span>
                    </a>

                </div>
                <ul class="menu">
                    <li ><a href="/">网站首页</a></li>
                    <li class="dropdown">
                        <a href="#">重点专科</a>
                        <ul class="dropdown-menu">
                            <li class="dropdown">
                                <a href="#">专家团队</a>
                                <ul class="dropdown-menu left-auto">
                                    <li><a href="/reception/Department">科室分类</a></li>
                                    <li class="active"><a href="/reception/expert">专家名录</a></li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#">中药专区</a>
                                <ul class="dropdown-menu left-auto">
                                    <li><a href="/reception/toDrugs">道地药材</a></li>
                                    <li onclick="reyc()"><a >煎药预约</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#">看诊服务</a>
                        <ul class="dropdown-menu">
                            <li><a href="/reception/chat">线上问诊</a></li>
                            <li onclick="reys()"><a >预约面诊</a></li>
                        </ul>
                    </li>
                    <li><a href="/reception/toForum">中医健康科普</a></li>
                    <li><a href="/reception/about">关于我们</a></li>

                </ul>

            </nav>
        </header>

        <!-- Header End -->

        <!-- SERVICE PAGE BANNER -->

        <div class="page-banner">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="page-banner-content">
                            <div class="d-sm-flex justify-content-between align-items-center">
                                <div class="title">
                                    <h6 class="text-left text-capitalized">看诊服务</h6>
                                    <h2>预约面诊</h2>
                                </div>
                                <div class="link text-sm-right text-left">
                                    <a href="/">主页 <i class="ti-angle-double-right"></i></a>
                                    看诊服务 <i class="ti-angle-double-right"></i> 预约面诊
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SERVICE PAGE BANNER  END-->

        <!-- BLOG PAGE SECTION -->

        <section class="blog-page" style="height:300px">
            <div style="margin-left: 20%;width:180px;margin-top: -3%">
                <div id='calendar' style="width:600px;height:400px"></div>
            </div>
            <div style="margin-top: -25%;margin-left: 70%" id="doctorList">
                <div id="timePeriod"></div></br>
                <select id="symptom" name="symptom" class="form-control selectpicker" style="width:30%">
                    <option value="">请选择症状</option>
                </select></br></br></br></br>
                <a href="#" class="btn btn-default btn-lg" role="button" onclick="toConfirm()">预约</a>
            </div>
        </section>


        <!-- CONTACT SECTION START -->



        <!-- CONTACT SECTION END -->

        <!-- FOOTER START -->

       <footer class="footer-section" style="margin-top: 15%">
           <div class="container">
               <div class="row">
                   <div class="col-12">
                       <div class="footer-content d-md-flex justify-content-between align-items-center text-center">
                           <p>Copyright © 2023 <a href="#">nnnu.com</a> 最终解释权属于yyc
                           </p>

                       </div>
                   </div>
               </div>
           </div>
       </footer>

        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="bookingForm" action="/receptionApi/addYYs" method="post">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    预约人
                                </label>
                                <div class="col-sm-6">
                                    <input class="form-control" id="user" type="text" th:placeholder="${username}" disabled>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    预约医生
                                </label>
                                <div class="col-sm-6">
                                    <input class="form-control" id="doctor" type="text" th:placeholder="${doctorName}" disabled>
                                    <input type="hidden" name="reservationName" th:value="${doctorName}">
                                    <input type="hidden" name="doctorId" th:value="${doctorId}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    预约时间
                                </label>
                                <div class="col-sm-6">
                                    <input class="form-control" id="timeVal" type="text" placeholder="" disabled>
                                    <input type="hidden" id="bookingTime" name="reservationTime">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    预约时段
                                </label>
                                <div class="col-sm-6">
                                    <input class="form-control" id="timePeriodVal" type="text" placeholder="" disabled>
                                    <input type="hidden" id="bookingTimePeriod" name="timePeriod">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    症状
                                </label>
                                <div class="col-sm-6">
                                    <input class="form-control" id="symptomVal" type="text" placeholder="" disabled>
                                    <input type="hidden" id="symptomHid" name="symptom">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="subBooking()">确认</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>

        <!-- FOOTER END -->

        <script src="/docByq/js/jquery-3.3.1.min.js"></script>
        <script src="/docByq/js/bootstrap.min.js"></script>
        <script src="/docByq/js/owl.carousel.min.js"></script>
        <script src="/docByq/js/coreNavigation-1.1.3.min.js"></script>
        <script src="/docByq/js/jquery.fancybox.min.js"></script>
        <script src="/docByq/js/mixitup.min.js"></script>
        <script src="/docByq/js/popper.min.js"></script>
        <script src="/docByq/js/script.js"></script>
<input type="hidden" id="id"/>

    </body>
    <script>
        userInfo(function (res) {
            console.log("失败")
            console.log(res)
            if (res.code == 500) {

            } else {
                $("#username").text(res.data.userInfo.username);
                $("#id").val(res.data.id);
                $("#dome1").append("<i class=\"layui-icon layui-icon-down layui-font-12\"></i>");
                layui.use('dropdown', function () {
                    var dropdown = layui.dropdown
                    dropdown.render({
                        elem: '#demo1' //可绑定在任意元素中，此处以上述按钮为例
                        , data: [{
                            title: '修改密码'
                            , id: 100
                            //,href: '#'
                        }, {
                            title: '个人信息'
                            , id: 101
                            //,href: 'https://www.layui.com/' //开启超链接
                            //,target: '_blank' //新窗口方式打开
                        }, {
                            title: '我的收藏'
                            , id: 101
                            , href: '/reception/toForumByMy?id=' + res.data.id //开启超链接
                            //,target: '_blank' //新窗口方式打开
                        }, {
                            title: '我的留言'
                            , id: 101
                            , href: '/reception/toMyProposal?id=' + res.data.id //开启超链接
                            //,target: '_blank' //新窗口方式打开
                        }, {
                            title: '我的预约'
                            , id: 101
                            ,href: '/reception//toMyReserve?id='+res.data.id //开启超链接
                            //,target: '_blank' //新窗口方式打开
                        }
                        ]
                        , id: 'demo1'
                        //菜单被点击的事件
                        , click: function (obj) {
                            console.log(obj);
                            if (obj.title == '修改密码') {
                                xadmin.open('修改密码', '/reception/toPassword', '580', '600', false);
                                // layer.msg('修改密码');
                            }
                            if (obj.title == '个人信息') {
                                xadmin.open('修改密码', '/reception/toUserInfo', '580', '600', false);
                                // layer.msg('个人信息');
                            }


                        }
                    });
                });
            }

        })

        function reyc() {
            var id = $("#id").val();
            if (id==''||id==null){
                window.location.href='/login/user';
            }
            xadmin.open('预约煎药', '/reception/toreYc', '580', '600', false);
        }

        function reys() {
            var id = $("#id").val();
            if (id==''||id==null){
                window.location.href='/login/user';
            }
            xadmin.open('预约面诊', '/reception/toreYs', '580', '600', false);
        }

    </script>
    <script >
        var map = {};
        function dealWithData(){
            var eventsList = [];
            $.ajax({
                type:"get",
                url:"/schedule/querySchedule?userId="+[[${userId}]],
                async:false,
                processData:false,
                contentType: "application/json",
                success:function(res){
                    if(res != undefined && res != ""){
                        for (let schedule of res) {
                            map[schedule.bookingTimeStr]=schedule.timePeriodList;
                            if(schedule.signalSource != undefined && schedule.signalSource > 0){
                                eventsList.push({
                                    title: '有号',
                                    textColor: 'green',
                                    color: 'transparent',
                                    className: 'done',
                                    start: schedule.bookingTimeStr,
                                })
                            }else {
                                eventsList.push({
                                    title: '约满',
                                    textColor: 'red',
                                    color: 'transparent',
                                    className: 'done',
                                    start: schedule.bookingTimeStr,
                                })
                            }
                        }
                    }
                }
            });
            return eventsList;
        }
        document.addEventListener('DOMContentLoaded', function() {
            querySymptom();
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultDate: '2018-03-12',
                selectable: true,
                locale:'zh-cn',
                // weekends: false, 不显示周六日
                selectHelper: true,
                events: dealWithData(),
                initialView: 'dayGridMonth'
            });
            calendar.on('dateClick', function(info) {
                toTime(info.dateStr);
            });
            calendar.render();
            calendar.batchRendering(function() {
                calendar.changeView('dayGridMonth');
                calendar.addEvent({ title: 'new event', start: '2023-09-01' });
            });
        });

        function toTime(time) {
            $("#timeVal").attr("placeholder",time);
            $("#bookingTime").val(time);
            let scheduleTime = map[time];
            $("#timePeriod").html("");
            if(scheduleTime){
                var period = "";
                for (let schedule of scheduleTime) {
                    if(schedule.signalSource != undefined && schedule.signalSource > 0){
                        period += "<input type=\"radio\" name=\"timePeriod\" value="+schedule.timePeriod+" title=\"\" ><span>"+schedule.timePeriod+" "+"余号："+schedule.signalSource+"</span></br>";
                    }else {
                        period += "<input type=\"radio\" name=\"timePeriod\" value="+schedule.timePeriod+" title=\"\" disabled><span>"+schedule.timePeriod+" "+"约满</span></br>";
                    }
                }
                $("#timePeriod").html(period);
            }else {
                layer.msg("当前时段不可约，请选择其他时段");
            }
        }

        function toConfirm() {
            if(!$("input[name='timePeriod']:checked").val()){
                layer.msg("请选择预约时间及时段")
                return
            }
            if(!$("#symptom").val()){
                layer.msg("请选择症状")
                return
            }
            $("#symptomVal").attr("placeholder",$("#symptom").val());
            $("#symptomHid").val($("#symptom").val());
            $("#timePeriodVal").attr("placeholder",$("input[name='timePeriod']:checked").val());
            $("#bookingTimePeriod").val($("input[name='timePeriod']:checked").val());
            $('#myModal').modal('show')
        }

        function subBooking() {
            $('#bookingForm').submit();
        }

        function querySymptom() {
            $.ajax({
                type:"get",
                url:"/departments/querySymptom",
                async:false,
                processData:false,
                contentType: "application/json",
                success:function(res){
                    if(res != undefined && res != ""){
                        var optArr = [];
                        for (var i = 0; i < res.length; i++) {
                            $('.selectpicker').append("<option value=" + res[i] + ">" + res[i] + "</option>");
                        }
                        $('#symptom').selectpicker('refresh');
                        $('#symptom').selectpicker('render');
                    }
                }
            });
        }

    </script>
</html>
